<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NextScout | Giris</title>
  <meta name="description" content="NextScout giris ve kayit sayfasi.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Archivo+Black&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #08131d;
      --panel: #0f1f2e;
      --panel-2: #12293d;
      --line: #2b4660;
      --text: #f5fbff;
      --muted: #9bb5cb;
      --cta: #ff5a1f;
      --cta-2: #ff7e22;
      --ok: #2fd4b0;
      --err: #ff6b6b;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Space Grotesk", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 12% 8%, rgba(38, 84, 124, 0.45) 0%, transparent 36%),
        radial-gradient(circle at 92% 0%, rgba(255, 90, 31, 0.18) 0%, transparent 26%),
        var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 22px;
    }

    .auth-shell {
      width: min(1080px, 100%);
      min-height: min(720px, calc(100vh - 44px));
      border: 1px solid var(--line);
      border-radius: 22px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr 1fr;
      background: linear-gradient(160deg, rgba(18, 41, 61, 0.95), rgba(10, 22, 33, 0.98));
      box-shadow: 0 28px 60px rgba(0, 0, 0, 0.35);
    }

    .visual {
      padding: 34px;
      border-right: 1px solid #2c4762;
      background:
        linear-gradient(150deg, rgba(28, 66, 97, 0.55), rgba(13, 28, 42, 0.72)),
        url("pdf_pages/page-10.png") center/cover no-repeat;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      gap: 16px;
    }

    .brand {
      margin: 0;
      font-family: "Archivo Black", sans-serif;
      letter-spacing: .5px;
      font-size: 1.15rem;
      align-self: flex-start;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.26);
      background: rgba(0,0,0,.22);
    }

    .brand span { color: var(--cta); }

    .visual h1 {
      margin: 0;
      font-size: clamp(1.8rem, 3.4vw, 2.8rem);
      line-height: 1.06;
      max-width: 12ch;
      font-family: "Archivo Black", sans-serif;
      text-shadow: 0 6px 18px rgba(0,0,0,.4);
    }

    .visual p {
      margin: 0;
      color: #d4e6f4;
      max-width: 36ch;
      font-size: .96rem;
    }

    .panel {
      padding: 28px;
      display: flex;
      flex-direction: column;
      background: linear-gradient(165deg, rgba(17, 39, 58, .94), rgba(10, 21, 32, .98));
    }

    .topline {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .header-square-wrap {
      display: grid;
      place-items: center;
      margin-bottom: 14px;
    }

    .header-square {
      width: clamp(56px, 10vw, 86px);
      aspect-ratio: 1 / 1;
      border-radius: 12px;
      border: 1px solid #3a5b7a;
      background: linear-gradient(145deg, rgba(255, 126, 34, 0.26), rgba(25, 50, 74, 0.78));
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.28);
    }

    .home-link {
      color: #d9e9f6;
      text-decoration: none;
      border: 1px solid #3b5e7f;
      border-radius: 999px;
      padding: 8px 12px;
      font-size: .8rem;
      font-weight: 700;
      background: rgba(24, 45, 64, 0.66);
    }

    .tab-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      border: 1px solid #34526d;
      border-radius: 12px;
      overflow: hidden;
      background: rgba(16, 33, 48, .7);
    }

    .tab {
      border: 0;
      background: transparent;
      color: #cde0f1;
      padding: 11px 10px;
      font: inherit;
      font-size: .86rem;
      font-weight: 700;
      cursor: pointer;
    }

    .tab.active {
      color: #101520;
      background: linear-gradient(135deg, var(--cta), var(--cta-2));
    }

    .form {
      margin-top: 16px;
      display: grid;
      gap: 11px;
    }

    .form[hidden] { display: none; }

    label {
      font-size: .8rem;
      color: #b7cfe4;
      margin-bottom: 4px;
      display: block;
    }

    input, select {
      width: 100%;
      border: 1px solid #3b5e7f;
      border-radius: 10px;
      background: rgba(19, 38, 56, .85);
      color: var(--text);
      padding: 11px 12px;
      font: inherit;
      font-size: .92rem;
      outline: none;
    }

    input:focus, select:focus {
      border-color: #ff9b48;
      box-shadow: 0 0 0 2px rgba(255, 126, 34, .18);
    }

    .row2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .btn {
      border: 0;
      border-radius: 12px;
      padding: 12px 14px;
      font: inherit;
      font-size: .92rem;
      font-weight: 700;
      color: #11131a;
      background: linear-gradient(135deg, var(--cta), var(--cta-2));
      cursor: pointer;
      margin-top: 4px;
    }

    .msg {
      margin-top: 12px;
      min-height: 20px;
      font-size: .84rem;
      font-weight: 600;
      color: #d0e2f2;
    }

    .msg.ok { color: var(--ok); }
    .msg.err { color: var(--err); }

    .hint {
      margin-top: auto;
      color: #95b2c8;
      font-size: .78rem;
      line-height: 1.45;
      padding-top: 18px;
    }

    @media (max-width: 920px) {
      .auth-shell {
        grid-template-columns: 1fr;
        min-height: auto;
      }

      .visual {
        min-height: 250px;
        border-right: 0;
        border-bottom: 1px solid #2c4762;
      }

      .panel { padding: 22px; }
    }

    @media (max-width: 520px) {
      .row2 { grid-template-columns: 1fr; }
      .visual { padding: 22px; }
      .panel { padding: 18px; }
    }
  </style>
</head>
<body>
  <main class="auth-shell">
    <section class="visual" aria-label="Marka paneli">
      <p class="brand">NEXT<span>SCOUT</span></p>
      <h1>Tek giris, tek panel, net akis.</h1>
      <p>Oyuncu, scout, menajer, antrenor ve takim hesaplarini ayni noktadan yonet.</p>
    </section>

    <section class="panel" aria-label="Kimlik dogrulama paneli">
      <div class="header-square-wrap" aria-hidden="true">
        <div class="header-square"></div>
      </div>
      <div class="topline">
        <a class="home-link" href="index.html">Ana Sayfaya Don</a>
        <div class="tab-row" role="tablist" aria-label="Form secimi">
          <button class="tab active" id="tab-login" type="button" role="tab" aria-selected="true">Giris</button>
          <button class="tab" id="tab-register" type="button" role="tab" aria-selected="false">Kayit</button>
        </div>
      </div>

      <form id="login-form" class="form" novalidate>
        <div>
          <label for="login-email">E-posta</label>
          <input id="login-email" type="email" required autocomplete="email">
        </div>
        <div>
          <label for="login-password">Sifre</label>
          <input id="login-password" type="password" required autocomplete="current-password">
        </div>
        <button class="btn" type="submit">Giris Yap</button>
      </form>

      <form id="register-form" class="form" novalidate hidden>
        <div>
          <label for="reg-name">Ad Soyad</label>
          <input id="reg-name" type="text" minlength="2" maxlength="120" required autocomplete="name">
        </div>
        <div class="row2">
          <div>
            <label for="reg-email">E-posta</label>
            <input id="reg-email" type="email" required autocomplete="email">
          </div>
          <div>
            <label for="reg-role">Rol</label>
            <select id="reg-role" required>
              <option value="player">Oyuncu</option>
              <option value="scout">Scout</option>
              <option value="manager">Menajer</option>
              <option value="coach">Antrenor</option>
              <option value="team">Takim</option>
            </select>
          </div>
        </div>
        <div class="row2">
          <div>
            <label for="reg-password">Sifre</label>
            <input id="reg-password" type="password" minlength="8" required autocomplete="new-password">
          </div>
          <div>
            <label for="reg-password-confirm">Sifre Tekrar</label>
            <input id="reg-password-confirm" type="password" minlength="8" required autocomplete="new-password">
          </div>
        </div>
        <div class="row2">
          <div>
            <label for="reg-city">Sehir (opsiyonel)</label>
            <input id="reg-city" type="text" maxlength="80" autocomplete="address-level2">
          </div>
          <div>
            <label for="reg-phone">Telefon (opsiyonel)</label>
            <input id="reg-phone" type="text" maxlength="30" autocomplete="tel">
          </div>
        </div>
        <button class="btn" type="submit">Kayit Ol</button>
      </form>

      <p id="form-msg" class="msg" aria-live="polite"></p>

      <p class="hint">Basarili giris veya kayitta token tarayiciya kaydedilir ve ana sayfaya donus yapilir.</p>
    </section>
  </main>

  <script>
    (function () {
      const DEFAULT_LIVE_API_BASE = "https://scout-api-91m6.onrender.com/api";
      const params = new URLSearchParams(window.location.search);
      const API_BASE = params.get("api_base") || localStorage.getItem("nextscout_api_base") || window.NEXTSCOUT_API_BASE || DEFAULT_LIVE_API_BASE;

      const tabLogin = document.getElementById("tab-login");
      const tabRegister = document.getElementById("tab-register");
      const loginForm = document.getElementById("login-form");
      const registerForm = document.getElementById("register-form");
      const msg = document.getElementById("form-msg");

      const showMessage = (text, mode) => {
        msg.textContent = text;
        msg.className = "msg" + (mode ? " " + mode : "");
      };

      const setMode = (mode) => {
        const loginMode = mode === "login";
        tabLogin.classList.toggle("active", loginMode);
        tabRegister.classList.toggle("active", !loginMode);
        tabLogin.setAttribute("aria-selected", loginMode ? "true" : "false");
        tabRegister.setAttribute("aria-selected", loginMode ? "false" : "true");
        loginForm.hidden = !loginMode;
        registerForm.hidden = loginMode;
        showMessage("", "");
      };

      tabLogin.addEventListener("click", () => setMode("login"));
      tabRegister.addEventListener("click", () => setMode("register"));

      const buildDashboardUrl = () => {
        const current = new URL(window.location.href);
        const apiBase = current.searchParams.get("api_base");
        return apiBase ? "dashboard.html?api_base=" + encodeURIComponent(apiBase) : "dashboard.html";
      };

      const postJson = async (path, payload) => {
        const response = await fetch(API_BASE + path, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const data = await response.json().catch(() => ({}));
        if (!response.ok || !data?.ok) {
          const validation = data?.errors ? Object.values(data.errors).flat()[0] : null;
          throw new Error(validation || data?.message || "Islem basarisiz.");
        }
        return data;
      };

      loginForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        showMessage("Giris yapiliyor...", "");

        const email = document.getElementById("login-email").value.trim();
        const password = document.getElementById("login-password").value;

        try {
          const result = await postJson("/auth/login", { email, password });
          localStorage.setItem("nextscout_token", result.data.token);
          showMessage("Giris basarili. Yonlendiriliyor...", "ok");
          setTimeout(() => { window.location.href = buildDashboardUrl(); }, 350);
        } catch (error) {
          showMessage(error.message, "err");
        }
      });

      registerForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        showMessage("Kayit olusturuluyor...", "");

        const payload = {
          name: document.getElementById("reg-name").value.trim(),
          email: document.getElementById("reg-email").value.trim(),
          role: document.getElementById("reg-role").value,
          password: document.getElementById("reg-password").value,
          password_confirmation: document.getElementById("reg-password-confirm").value,
          city: document.getElementById("reg-city").value.trim() || null,
          phone: document.getElementById("reg-phone").value.trim() || null
        };

        try {
          const result = await postJson("/auth/register", payload);
          localStorage.setItem("nextscout_token", result.data.token);
          showMessage("Kayit basarili. Yonlendiriliyor...", "ok");
          setTimeout(() => { window.location.href = buildDashboardUrl(); }, 350);
        } catch (error) {
          showMessage(error.message, "err");
        }
      });
    })();
  </script>
</body>
</html>

{
  "info": {
    "_postman_id": "53c2e39a-e5eb-4f5e-8dca-d6cdd4f5b47f",
    "name": "Scout API E2E - Communication and Media",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth - Register Manager",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('register manager status', function () {",
              "  pm.expect([200, 201]).to.include(pm.response.code);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Manager User\",\n  \"email\": \"manager@example.com\",\n  \"password\": \"Password123\",\n  \"password_confirmation\": \"Password123\",\n  \"role\": \"manager\",\n  \"city\": \"Istanbul\"\n}"
        },
        "url": "{{base_url}}/api/auth/register"
      }
    },
    {
      "name": "Auth - Register Scout",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('register scout status', function () {",
              "  pm.expect([200, 201]).to.include(pm.response.code);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Scout User\",\n  \"email\": \"scout@example.com\",\n  \"password\": \"Password123\",\n  \"password_confirmation\": \"Password123\",\n  \"role\": \"scout\",\n  \"city\": \"Ankara\"\n}"
        },
        "url": "{{base_url}}/api/auth/register"
      }
    },
    {
      "name": "Auth - Login Manager",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('manager login status', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "pm.collectionVariables.set('manager_token', json.data.token);",
              "pm.collectionVariables.set('manager_user_id', String(json.data.user.id));"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"manager@example.com\",\n  \"password\": \"Password123\"\n}"
        },
        "url": "{{base_url}}/api/auth/login"
      }
    },
    {
      "name": "Auth - Login Scout",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('scout login status', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "pm.collectionVariables.set('scout_token', json.data.token);",
              "pm.collectionVariables.set('scout_user_id', String(json.data.user.id));"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"scout@example.com\",\n  \"password\": \"Password123\"\n}"
        },
        "url": "{{base_url}}/api/auth/login"
      }
    },
    {
      "name": "Contact - Send Manager to Scout",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('contact create status', function () {",
              "  pm.response.to.have.status(201);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "pm.collectionVariables.set('contact_id', String(json.data.id));"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{manager_token}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"to_user_id\": {{scout_user_id}},\n  \"subject\": \"Trial Update\",\n  \"message\": \"Scout review requested\"\n}"
        },
        "url": "{{base_url}}/api/contacts"
      }
    },
    {
      "name": "Contact - Inbox Scout",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('inbox status', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "const rows = json?.data?.data || [];",
              "pm.expect(rows.length).to.be.above(0);"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{scout_token}}" }
        ],
        "url": "{{base_url}}/api/contacts/inbox?status=new&sort_by=created_at&sort_dir=desc&per_page=10"
      }
    },
    {
      "name": "Contact - Mark Read",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('mark read status', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "pm.expect(json.data.status).to.eql('read');"
            ]
          }
        }
      ],
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "Authorization", "value": "Bearer {{scout_token}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"read\"\n}"
        },
        "url": "{{base_url}}/api/contacts/{{contact_id}}/status"
      }
    },
    {
      "name": "Contact - Sent Manager",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('sent status', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "const rows = json?.data?.data || [];",
              "pm.expect(rows.length).to.be.above(0);"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{manager_token}}" }
        ],
        "url": "{{base_url}}/api/contacts/sent?status=read&sort_by=created_at&sort_dir=desc&per_page=10"
      }
    },
    {
      "name": "Media - Upload by Manager",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('media upload status', function () {",
              "  pm.response.to.have.status(201);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "pm.collectionVariables.set('media_id', String(json.data.id));"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{manager_token}}" }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            { "key": "title", "value": "Manager Upload", "type": "text" },
            { "key": "file", "type": "file", "src": "{{media_file_path}}" }
          ]
        },
        "url": "{{base_url}}/api/media"
      }
    },
    {
      "name": "Media - List by Manager",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('media list status', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);",
              "const rows = json?.data?.data || [];",
              "pm.expect(rows.length).to.be.above(0);"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{manager_token}}" }
        ],
        "url": "{{base_url}}/api/users/{{manager_user_id}}/media?type=image&sort_by=created_at&sort_dir=desc&per_page=10"
      }
    },
    {
      "name": "Media - Delete by Manager",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('media delete status', function () {",
              "  pm.response.to.have.status(200);",
              "});",
              "const json = pm.response.json();",
              "pm.expect(json.ok).to.eql(true);"
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [
          { "key": "Authorization", "value": "Bearer {{manager_token}}" }
        ],
        "url": "{{base_url}}/api/media/{{media_id}}"
      }
    }
  ],
  "variable": [
    { "key": "manager_token", "value": "" },
    { "key": "scout_token", "value": "" },
    { "key": "manager_user_id", "value": "" },
    { "key": "scout_user_id", "value": "" },
    { "key": "contact_id", "value": "" },
    { "key": "media_id", "value": "" }
  ]
}
